machine:
  php:
    version: 7.1.3
  node:
    version: 7.6
  services:
    - redis
    - memcached
  hosts:
    registry.dev: 127.0.0.1

checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - mv .env.circle .env

dependencies:
  cache_directories:
    - ~/.composer
    - ~/.cache/yarn
  override:
    - npm update vue
    - npm update vue-template-compiler
    - yarn
    - sudo composer self-update && composer --version
    - sudo chown ubuntu ~/.composer -R
    - composer install --prefer-dist --no-interaction --no-dev

test:
  pre:
    - npm run production
    - php artisan migrate -vvv --seed --force
    - php artisan key:generate
  override:
    - ./vendor/bin/phpunit
